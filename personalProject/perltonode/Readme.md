dwilson.gis_polygon gp
dwilson.crawler_parcels c
sde.address
sde.audittracking


INSERT INTO sde.address
            (objectid, creationuser, datecreated, addresstext, addresstype, city, state, zipcode,
              ipid, id, threegisid, globalid, shape, address_notes,
              house_number, street_direction, streetaddress, street_suffix, post_dir, unitnumber)
          VALUES
            (sde.gdb_util.next_rowid('SDE', 'Address'), sde.sde_util.sde_user, SYSDATE, UPPER(?), ?, UPPER(?), UPPER(?), ?,
              ?, ?, ?, ?, sdo_cs.transform(sdo_geometry(?, 8307), 3857), '($poly)[' || ? || ']',
              UPPER(?), UPPER(?), UPPER(?), UPPER(?), UPPER(?), UPPER(?))


INSERT INTO sde.audittracking
          (objectid, edittype, layername, username, edit_date, threegisid, globalid)
          VALUES
          (sde.gdb_util.next_rowid('SDE', 'AUDITTRACKING'), 'Create', 'Address', sde.sde_util.sde_user, sysdate, ?, ?)
        ")


gis_polygon
    polygon_id
    polygon_name
    coordinates

crawler_parcels
    ROWID crawler_rowid
    parcel_number
    id
    city
    state
    zip
    property_type
    address
    coordinates

address
    objectid, 
    creationuser, 
    datecreated, 
    addresstext, 
    addresstype, 
    city, 
    state, 
    zipcode,
    ipid, 
    id, 
    threegisid, 
    globalid, 
    shape, 
    address_notes,
    house_number, 
    street_direction, 
    streetaddress, 
    street_suffix, 
    post_dir, 
    unitnumber


CREATE TABLE address1(
    id NUMBER GENERATED BY DEFAULT AS IDENTITY,
    creationuser VARCHAR2(50) NOT NULL,
    datecreated VARCHAR2(50) NOT NULL,
    addresstext VARCHAR2(50) NOT NULL,
    addresstype VARCHAR2(50) NOT NULL,
    city VARCHAR2(50) NOT NULL,
    state VARCHAR2(50) NOT NULL,
    zipcode NUMBER NOT NULL,
    ipid NUMBER NOT NULL,
    threegisid NUMBER NOT NULL,
    globalid NUMBER NOT NULL,
    shape VARCHAR2(50) NOT NULL,
    address_notes VARCHAR2(50) NOT NULL,
    house_number NUMBER NOT NULL,
    street_direction VARCHAR2(50) NOT NULL,
    streetaddress VARCHAR2(50) NOT NULL,
    street_suffix VARCHAR2(50) NOT NULL,
    post_dir VARCHAR2(50) NOT NULL,
    unitnumber NUMBER NOT NULL,
    created_at DATE,
    PRIMARY KEY(id)
);


create table crawler_parcels1(
    id NUMBER GENERATED BY DEFAULT AS IDENTITY,
    parcel_number VARCHAR2(50) NOT NULL,
    city VARCHAR2(50) NOT NULL,
    state VARCHAR2(50) NOT NULL,
    zip VARCHAR2(50) NOT NULL,
    property_type VARCHAR2(50) NOT NULL,
    address VARCHAR2(50) NOT NULL,
    coordinates VARCHAR2(50) NOT NULL,
    PRIMARY KEY(id)
)



 const addrq =`
      SELECT crawler_rowid,
        parcel_number,
        source_id,
        address_type,
        address,
        city,
        state,
        zip
      FROM (
        SELECT cp.crawler_rowid,
          cp.parcel_number,
          cp.source_id,
          CASE
            WHEN (cp.property_type = 'RESIDENTIAL') THEN 'SFU'
            WHEN (cp.property_type = 'COMMERCIAL') THEN 'SBU'
            WHEN (cp.property_type = 'GOVERNMENT') THEN 'GOVT'
            WHEN (cp.property_type = 'APARTMENTS') THEN 'MTU'
            WHEN (cp.property_type = 'VACANT') THEN 'VAC'
            ELSE 'OTH'
          END address_type,
          cp.address,
          cp.city,
          cp.state,
          NVL(cp.zip, '00000') zip
        FROM (
          SELECT /*+ NO_MERGE */
            crawler_rowid,
            parcel_number,
            polygon_id,
            polygon_name,
            MAX(id) source_id,
            address,
            city,
            state,
            zip,
            property_type
          FROM (
            SELECT x.ROWID crawler_rowid,
              x.parcel_number,
              gp.id polygon_id,
              gp.polygon_name,
              x.id,
              REGEXP_REPLACE(REGEXP_REPLACE(REGEXP_REPLACE(
                REGEXP_REPLACE(REGEXP_REPLACE(REGEXP_REPLACE(
                RTRIM(RTRIM(UPPER(TRIM(x.address)), ','), '.'),
                ' STREET ST$', ' ST'), ' DRIVE DR$', ' DR'), ' ROAD RD$', ' RD'),
                ' STREET ST ', ' ST '), ' DRIVE DR ', ' DR '), ' ROAD RD ', ' RD ')
              address,
              UPPER(x.city) city,
              UPPER(x.state) state,
              x.zip,
              x.property_type
            FROM dwilson.gis_polygon gp,
              dwilson.crawler_parcels x
            WHERE (address IS NOT NULL OR property_type = 'VACANT')
              AND SDO_RELATE(x.coordinates, gp.coordinates, 'mask=anyinteract querytype=window') = 'TRUE'
          )
          GROUP BY crawler_rowid, parcel_number, polygon_id, polygon_name, address, city, state, zip, property_type
        ) cp
        WHERE cp.polygon_id = :poly
      )
    `;

create table gis_polygon1 (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY,
    polygon_id VARCHAR2(50) NOT NULL,
    polygon_name VARCHAR2(50) NOT NULL,
    coordinates VARCHAR2(50) NOT NULL,
    PRIMARY KEY(id)
)
select * from gis_polygon1;


INSERT INTO crawler_parcels1
        (parcel_number, city, state, zip, property_type, address, coordinates)
      VALUES
        ('1234', 'bangalore', 'kar', '560078', 'office', 'jpnagar', '12345');

SELECT ROWID as crawler_rowid, parcel_number, id, address, city, zip, state, property_type  FROM crawler_parcels1

CREATE SEQUENCE next_globalid
    START WITH 1
    INCREMENT BY 1;
    
SELECT next_globalid.NEXTVAL FROM dual;